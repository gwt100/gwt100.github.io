const PASSWORD = '8525';

addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request));
});

async function handleRequest(request) {
  const url = new URL(request.url);
  const password = url.searchParams.get('password');
  const userAgent = request.headers.get('User-Agent') || '';

  // å®šä¹‰å¸¸è§æµè§ˆå™¨çš„ User-Agent ç‰‡æ®µ
  const browserUserAgents = [
    'Mozilla', 'Chrome', 'Safari', 'Firefox', 'Edge', 'Opera'
  ];

  // å®šä¹‰å¸¸è§æ’­æ”¾å™¨çš„ User-Agent ç‰‡æ®µ
  const playerUserAgents = [
    'VLC', 'ExoPlayerLib', 'iOSPlayer', 'AndroidPlayer'
  ];

  // æ£€æŸ¥æ˜¯å¦ä¸ºæµè§ˆå™¨è¯·æ±‚
  const isBrowserRequest = browserUserAgents.some(agent => userAgent.includes(agent));

  // æ£€æŸ¥æ˜¯å¦ä¸ºæ’­æ”¾å™¨è¯·æ±‚
  const isPlayerRequest = playerUserAgents.some(agent => userAgent.includes(agent));

  // å¦‚æœæ˜¯æµè§ˆå™¨è¯·æ±‚ä¸”å¯†ç ä¸æ­£ç¡®ï¼Œè¿”å›å¸¦ç²‰çº¢è‰²èƒŒæ™¯çš„ HTML é¡µé¢
  if (isBrowserRequest && password !== PASSWORD) {
    return new Response(
      `<!DOCTYPE html>
      <html lang="zh-CN">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>æœªæˆæƒè®¿é—®</title>
        <style>
          body {
            background-color: pink;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            color: #333;
            text-align: center;
          }
          .container {
            max-width: 400px;
            margin: auto;
          }
          h1 {
            font-size: 3em;
            margin-bottom: 20px;
          }
          p {
            font-size: 1.2em;
          }
        </style>
      </head>
      <body>
        <div class="container">
          <h1>æ— æƒè®¿é—®</h1>
          <p>è‹¹æœè®¾å¤‡vodé«˜è´¨é‡ç‚¹æ’­æº</p>
          <p>å®‰å“TVbox å½±è§†ä»“ç‚¹æ’­æº</p>
          <p>å½±è§†ç‰‡æºä¸æ–­æ›´æ–°ä¸­.....</p>
          <img src="https://mi.gx10086.us.kg/file/1940efb4a6061af1ff0f3.gif" />
          <p>å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»å¾®ä¿¡ï¼š65267199</p>
          <p><img src="https://mi.gx10086.us.kg/file/e6a79fe23f8192acf022a.jpg" style="width: 66%; height: auto;" /></p>
        </div>
      </body>
      </html>`,
      {
        status: 401,
        headers: {
          'Content-Type': 'text/html; charset=utf-8',
          'Content-Language': 'zh-CN' // è®¾ç½®é¡µé¢è¯­è¨€ä¸ºä¸­æ–‡
        }
      }
    );
  }

  // JSONå†…å®¹ï¼Œæ‰€æœ‰å­—æ®µå·²ä½¿ç”¨ä¸­æ–‡è¡¨ç¤º
  const jsonResponse = {
    "sites": [
      {
        "key": "æš´é£â€ç‚¹æ’­",
        "name": "æš´é£â€ç‚¹æ’­",
        "type": 1,
        "api": "https://bfzyapi.com/api.php/provide/vod/",
        "playUrl": "",
        "categories": [
          "å›½äº§å‰§",
          "å›½äº§åŠ¨æ¼«",
          "å¤§é™†ç»¼è‰º",
          "æ¸¯å°ç»¼è‰º",
          "é¦™æ¸¯å‰§",
          "å°æ¹¾å‰§",
          "æ—¥æœ¬å‰§",
          "æ¬§ç¾å‰§",
          "æ³°å›½å‰§",
          "æ—¥æœ¬åŠ¨æ¼«",
          "æ—¥æœ¬ç»¼è‰º",
          "ç»¼è‰ºé¢‘é“",
          "æ–°é©¬æ³°ç»¼è‰º",
          "çºªå½•ç‰‡",
          "ç§‘å¹»ç‰‡",
          "å–œå‰§ç‰‡",
          "æˆ˜äº‰ç‰‡"
        ]
      },
      {
        "key": "å§é¾™â€ç‚¹æ’­",
        "name": "å§é¾™â€ç‚¹æ’­",
        "type": 1,
        "api": "https://collect.wolongzyw.com/api.php/provide/vod/",
        "searchable": 1,
        "quickSearch": 1
      },
      {
        "key": "é‡å­â€ç‚¹æ’­",
        "name": "é‡å­â€ç‚¹æ’­",
        "type": 1,
        "api": "http://cj.lziapi.com/api.php/provide/vod/",
        "searchable": 1,
        "quickSearch": 1
      },
      {
        "key": "çº¢ç‰›â€ç‚¹æ’­",
        "name": "çº¢ç‰›â€ç‚¹æ’­",
        "type": 1,
        "api": "https://www.hongniuzy2.com/api.php/provide/vod/",
        "searchable": 0,
        "quickSearch": 0
      },
      {
        "key": "ç´¢å°¼â€ç‚¹æ’­",
        "name": "ç´¢å°¼â€4 K",
        "type": 1,
        "api": "https://suoniapi.com/api.php/provide/vod/",
        "searchable": 1,
        "quickSearch": 1
      },
      {
        "key": "éå‡¡â€ç‚¹æ’­",
        "name": "éå‡¡â€ç‚¹æ’­",
        "type": 1,
        "api": "http://cj.ffzyapi.com/api.php/provide/vod/",
        "searchable": 1,
        "quickSearch": 1
      },
      {
        key: "é»‘æœ¨è€³èµ„æº",
        name: "æœ¨è€³ğŸ¥‘è“å…‰",
        type: 1,
        api: "https://json.heimuer.tv/api.php/provide/vod/?ac=list",
        searchable: 1,
        quickSearch: 1,
        filterable: 0,
        categories: [
          "å›½äº§å‰§", "éŸ©å‰§", "åŠ¨ç”»ç”µå½±", "ç½‘ç»œç”µå½±", "åŠ¨ä½œ", "å†’é™©", "çˆ±æƒ…", "è™æ‹", "é€†è¢­", "ç©¿è¶Š",
          "é‡ç”Ÿ", "æ¸¯å‰§", "æ³°å‰§", "æ—¥å‰§", "æ¬§ç¾å‰§", "å›½äº§ç»¼è‰º", "éŸ©å›½ç»¼è‰º", "æ—¥æœ¬ç»¼è‰º", "æ¬§ç¾ç»¼è‰º"
        ]
      },
      {
        key: "csp_xml_ikun",
        name: "çˆ±å¤ğŸ”è“å…‰",
        type: 1,
        api: "https://ikunzyapi.com/api.php/provide/vod/from/ikm3u8/at/json",
        searchable: 1,
        quickSearch: 1,
        filterable: 1,
        playerType: 2,
        categories: [
          "å›½äº§å‰§", "éŸ©å›½å‰§", "æ³°å›½å‰§", "æ¬§ç¾å‰§", "é¦™æ¸¯å‰§", "å°æ¹¾å‰§", "æ—¥æœ¬å‰§", "æµ·å¤–å‰§", "å›½äº§åŠ¨æ¼«",
          "æ—¥éŸ©åŠ¨æ¼«", "æ¬§ç¾åŠ¨æ¼«", "å¤§é™†ç»¼è‰º", "æ¸¯å°ç»¼è‰º", "æ—¥éŸ©ç»¼è‰º", "åŠ¨ä½œç‰‡", "å–œå‰§ç‰‡", "ç§‘å¹»ç‰‡",
          "ææ€–ç‰‡", "çˆ±æƒ…ç‰‡", "å‰§æƒ…ç‰‡", "æˆ˜äº‰ç‰‡", "è®°å½•ç‰‡", "çŠ¯ç½ªç‰‡", "æƒŠæ‚šç‰‡", "å¤è£…ç‰‡", "ç¾éš¾ç‰‡",
          "å†å²ç‰‡", "å…¶ä»–ç‰‡", "æ‚¬ç–‘ç‰‡", "å¥‡å¹»ç‰‡", "åŠ¨ç”»ç‰‡", "æ¬§ç¾ç»¼è‰º"
        ]
      },
      {
        key: "ä¹è§†",
        name: "ä¹è§†ğŸœè“å…‰",
        type: 1,
        api: "https://leshiapi.com/api.php/provide/vod/at/json/",
        searchable: 1,
        changeable: 1,
        categories: [
          "å›½äº§å‰§", "éŸ©å›½å‰§", "çŸ­å‰§", "æ³°å›½å‰§", "æ¬§ç¾å‰§", "é¦™æ¸¯å‰§", "å°æ¹¾å‰§", "æ—¥å‰§", "æµ·å¤–å‰§",
          "è®°å½•ç‰‡", "åè½¬çˆ½å‰§", "å¥³é¢‘æ‹çˆ±", "å¤è£…ä»™ä¾ ", "å¹´ä»£ç©¿è¶Š", "è„‘æ´æ‚¬ç–‘", "ç°ä»£éƒ½å¸‚", "å¤§é™†ç»¼è‰º",
          "æ¸¯å°ç»¼è‰º", "æ—¥éŸ©ç»¼è‰º", "æ¬§ç¾ç»¼è‰º", "å›½äº§åŠ¨æ¼«", "æ—¥æœ¬åŠ¨æ¼«", "æ¬§ç¾åŠ¨æ¼«", "ç”µå½±è§£è¯´", "åŠ¨ä½œç‰‡",
          "å†’é™©ç‰‡", "åŠ¨ç”»ç‰‡", "å–œå‰§ç‰‡", "çˆ±æƒ…ç‰‡", "å¥‡å¹»ç‰‡", "ç¾éš¾ç‰‡", "æ‚¬ç–‘ç‰‡", "ç§‘å¹»ç‰‡", "ææ€–ç‰‡",
          "å‰§æƒ…ç‰‡", "æˆ˜äº‰ç‰‡", "çŠ¯ç½ªç‰‡", "å…¶ä»–ç‰‡"
        ]
      },
      {
        key: "é‡å­èµ„æº",
        name: "é‡å­ğŸ¥‘è“å…‰",
        type: 1,
        api: "http://cj.lziapi.com/api.php/provide/vod/",
        searchable: 1,
        quickSearch: 1,
        filterable: 0,
        categories: [
          "å›½äº§å‰§", "å›½äº§åŠ¨æ¼«", "æ³°å›½å‰§", "éŸ©å›½å‰§", "çŸ­å‰§", "é¦™æ¸¯å‰§", "æ¬§ç¾å‰§", "å°æ¹¾å‰§", "æ—¥æœ¬å‰§",
          "æµ·å¤–å‰§", "æ—¥éŸ©åŠ¨æ¼«", "æ¬§ç¾åŠ¨æ¼«", "æ¸¯å°åŠ¨æ¼«", "æµ·å¤–åŠ¨æ¼«", "å¤§é™†ç»¼è‰º", "æ—¥éŸ©ç»¼è‰º", "æ¬§ç¾ç»¼è‰º",
          "åŠ¨ä½œç‰‡", "å†’é™©ç‰‡", "çˆ±æƒ…ç‰‡", "å¥‡å¹»ç‰‡", "ç¾éš¾ç‰‡", "ç§‘å¹»ç‰‡", "ææ€–ç‰‡", "å‰§æƒ…ç‰‡", "æˆ˜äº‰ç‰‡",
          "å–œå‰§ç‰‡"
        ]
      },
      {
        key: "csp_XYQHikerAL_å¤šå¤š",
        name: "Vä¿¡65267199",
        type: 3,
        api: "csp_XYQHikerAL",
        jar: "./lib/dongchen.jar",
        searchable: 1,
        quickSearch: 1,
        filterable: 1,
        ext: "./lib/duoduo.json"
      }
      
    ]
  };

  return new Response(JSON.stringify(jsonResponse), {
    headers: {
      'Content-Type': 'application/json; charset=utf-8',
      'Content-Language': 'zh-CN' // è®¾ç½®JSONå“åº”è¯­è¨€ä¸ºä¸­æ–‡
    }
  });
}
