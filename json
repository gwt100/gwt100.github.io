const PASSWORD = '8525';

addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request));
});

async function handleRequest(request) {
  const url = new URL(request.url);
  const password = url.searchParams.get('password');
  const userAgent = request.headers.get('User-Agent') || '';

  // 定义常见浏览器的 User-Agent 片段
  const browserUserAgents = [
    'Mozilla', 'Chrome', 'Safari', 'Firefox', 'Edge', 'Opera'
  ];

  // 定义常见播放器的 User-Agent 片段
  const playerUserAgents = [
    'VLC', 'ExoPlayerLib', 'iOSPlayer', 'AndroidPlayer'
  ];

  // 检查是否为浏览器请求
  const isBrowserRequest = browserUserAgents.some(agent => userAgent.includes(agent));

  // 检查是否为播放器请求
  const isPlayerRequest = playerUserAgents.some(agent => userAgent.includes(agent));

  // 如果是浏览器请求且密码不正确，返回带粉红色背景的 HTML 页面
  if (isBrowserRequest && password !== PASSWORD) {
    return new Response(
      `<!DOCTYPE html>
      <html lang="zh-CN">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>未授权访问</title>
        <style>
          body {
            background-color: pink;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            color: #333;
            text-align: center;
          }
          .container {
            max-width: 400px;
            margin: auto;
          }
          h1 {
            font-size: 3em;
            margin-bottom: 20px;
          }
          p {
            font-size: 1.2em;
          }
        </style>
      </head>
      <body>
        <div class="container">
          <h1>无权访问</h1>
          <p>苹果设备vod高质量点播源</p>
          <p>安卓TVbox 影视仓点播源</p>
          <p>影视片源不断更新中.....</p>
          <img src="https://mi.gx10086.us.kg/file/1940efb4a6061af1ff0f3.gif" />
          <p>如果您遇到问题，请联系微信：65267199</p>
          <p><img src="https://mi.gx10086.us.kg/file/e6a79fe23f8192acf022a.jpg" style="width: 66%; height: auto;" /></p>
        </div>
      </body>
      </html>`,
      {
        status: 401,
        headers: {
          'Content-Type': 'text/html; charset=utf-8',
          'Content-Language': 'zh-CN' // 设置页面语言为中文
        }
      }
    );
  }

  // JSON内容，所有字段已使用中文表示
  const jsonResponse = {
    "sites": [
      {
        "key": "暴风❀点播",
        "name": "暴风❀点播",
        "type": 1,
        "api": "https://bfzyapi.com/api.php/provide/vod/",
        "playUrl": "",
        "categories": [
          "国产剧",
          "国产动漫",
          "大陆综艺",
          "港台综艺",
          "香港剧",
          "台湾剧",
          "日本剧",
          "欧美剧",
          "泰国剧",
          "日本动漫",
          "日本综艺",
          "综艺频道",
          "新马泰综艺",
          "纪录片",
          "科幻片",
          "喜剧片",
          "战争片"
        ]
      },
      {
        "key": "卧龙❀点播",
        "name": "卧龙❀点播",
        "type": 1,
        "api": "https://collect.wolongzyw.com/api.php/provide/vod/",
        "searchable": 1,
        "quickSearch": 1
      },
      {
        "key": "量子❀点播",
        "name": "量子❀点播",
        "type": 1,
        "api": "http://cj.lziapi.com/api.php/provide/vod/",
        "searchable": 1,
        "quickSearch": 1
      },
      {
        "key": "红牛❀点播",
        "name": "红牛❀点播",
        "type": 1,
        "api": "https://www.hongniuzy2.com/api.php/provide/vod/",
        "searchable": 0,
        "quickSearch": 0
      },
      {
        "key": "索尼❀点播",
        "name": "索尼❀4 K",
        "type": 1,
        "api": "https://suoniapi.com/api.php/provide/vod/",
        "searchable": 1,
        "quickSearch": 1
      },
      {
        "key": "非凡❀点播",
        "name": "非凡❀点播",
        "type": 1,
        "api": "http://cj.ffzyapi.com/api.php/provide/vod/",
        "searchable": 1,
        "quickSearch": 1
      },
      {
        key: "黑木耳资源",
        name: "木耳🥑蓝光",
        type: 1,
        api: "https://json.heimuer.tv/api.php/provide/vod/?ac=list",
        searchable: 1,
        quickSearch: 1,
        filterable: 0,
        categories: [
          "国产剧", "韩剧", "动画电影", "网络电影", "动作", "冒险", "爱情", "虐恋", "逆袭", "穿越",
          "重生", "港剧", "泰剧", "日剧", "欧美剧", "国产综艺", "韩国综艺", "日本综艺", "欧美综艺"
        ]
      },
      {
        key: "csp_xml_ikun",
        name: "爱坤🐔蓝光",
        type: 1,
        api: "https://ikunzyapi.com/api.php/provide/vod/from/ikm3u8/at/json",
        searchable: 1,
        quickSearch: 1,
        filterable: 1,
        playerType: 2,
        categories: [
          "国产剧", "韩国剧", "泰国剧", "欧美剧", "香港剧", "台湾剧", "日本剧", "海外剧", "国产动漫",
          "日韩动漫", "欧美动漫", "大陆综艺", "港台综艺", "日韩综艺", "动作片", "喜剧片", "科幻片",
          "恐怖片", "爱情片", "剧情片", "战争片", "记录片", "犯罪片", "惊悚片", "古装片", "灾难片",
          "历史片", "其他片", "悬疑片", "奇幻片", "动画片", "欧美综艺"
        ]
      },
      {
        key: "乐视",
        name: "乐视🏜蓝光",
        type: 1,
        api: "https://leshiapi.com/api.php/provide/vod/at/json/",
        searchable: 1,
        changeable: 1,
        categories: [
          "国产剧", "韩国剧", "短剧", "泰国剧", "欧美剧", "香港剧", "台湾剧", "日剧", "海外剧",
          "记录片", "反转爽剧", "女频恋爱", "古装仙侠", "年代穿越", "脑洞悬疑", "现代都市", "大陆综艺",
          "港台综艺", "日韩综艺", "欧美综艺", "国产动漫", "日本动漫", "欧美动漫", "电影解说", "动作片",
          "冒险片", "动画片", "喜剧片", "爱情片", "奇幻片", "灾难片", "悬疑片", "科幻片", "恐怖片",
          "剧情片", "战争片", "犯罪片", "其他片"
        ]
      },
      {
        key: "量子资源",
        name: "量子🥑蓝光",
        type: 1,
        api: "http://cj.lziapi.com/api.php/provide/vod/",
        searchable: 1,
        quickSearch: 1,
        filterable: 0,
        categories: [
          "国产剧", "国产动漫", "泰国剧", "韩国剧", "短剧", "香港剧", "欧美剧", "台湾剧", "日本剧",
          "海外剧", "日韩动漫", "欧美动漫", "港台动漫", "海外动漫", "大陆综艺", "日韩综艺", "欧美综艺",
          "动作片", "冒险片", "爱情片", "奇幻片", "灾难片", "科幻片", "恐怖片", "剧情片", "战争片",
          "喜剧片"
        ]
      },
      {
        key: "csp_XYQHikerAL_多多",
        name: "V信65267199",
        type: 3,
        api: "csp_XYQHikerAL",
        jar: "./lib/dongchen.jar",
        searchable: 1,
        quickSearch: 1,
        filterable: 1,
        ext: "./lib/duoduo.json"
      }
      
    ]
  };

  return new Response(JSON.stringify(jsonResponse), {
    headers: {
      'Content-Type': 'application/json; charset=utf-8',
      'Content-Language': 'zh-CN' // 设置JSON响应语言为中文
    }
  });
}
